FROM python:3.11-slim
ENV PYTHONUNBUFFERED 1


# Install system dependencies
# RUN apt-get update && apt-get install -y --no-install-recommends \
#     gcc \
#     libc6-dev \
#     && rm -rf /var/lib/apt/lists/*

# Install Python dependencies
COPY requirements.txt .
RUN python -m venv /venv \
    && /venv/bin/pip install --upgrade pip \
    && /venv/bin/pip install --no-cache-dir --default-timeout=100 --retries 10 -r requirements.txt

ENV PATH="/venv/bin:$PATH"

COPY . .

WORKDIR /app
COPY ./django_test .

EXPOSE 8000

# RUN python manage.py migrate --no-input
# RUN python manage.py collectstatic --no-input

# CMD gunicorn --workers 3 --threads 2 --bind 0.0.0.0:8000 django_test.wsgi:application


COPY ./entrypoint_local.sh .
CMD [ "sh", "./entrypoint_local.sh" ]

